<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Login .. uglynotes</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/water.css">
    <link rel="stylesheet" href="/public/style2.css">
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <script src="/public/mithril.js"></script>
    <script src="/public/util2.js?v1"></script>
  </head>
  <body>
    <script>
      const root = document.body;

      const TopBanner = { view: () => m(
	'p',[
	  m('a', {href: 'https://github.com/ahui2016/uglynotes'}, 'uglynotes'),
	  ' .. Login'])
      };

      const Form = {
	Display: 'none',
	Show: () => { Form.Display = 'block'; },
	view: () => m(
	  'form', {style: {display:Form.Display}, autocomplete:'off'}, [
	    m('input', {
	      type:'password', id:'password', placeholder:'password',
	      style:'display:inline;', required:true}),
	    m('input', {type:'submit', value:'login', id:'submit',
			style:'display:inline;'})
	  ],
	),
	oncreate: vnode => { vnode.dom[0].focus(); }
      };
      
      const App = {
	oninit: () => {
	  m.request({
	    method: 'GET',
	    url: '/check',
	  }).then(resp => {
	    if (resp.message == 'OK') {
	      Alerts.Insert('success', '已登入');
	      return;
	    }
	    Form.Show();
	  }).catch(e => { Alerts.Insert('danger', e.message); })
	    .finally(() => { Loading.Hide(); });
	},
	view: () => [
	  m(TopBanner),
	  m(Loading),
	  m(Alerts),
	  m(Form),
	]
      };

      m.mount(root, App);

    </script>
  </body>
</html>
