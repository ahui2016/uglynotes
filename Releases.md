# Release 新版说明

## 2021-01-20 (在 note.html 显示笔记创建日期)

- 该更新不涉及 go 文件，只涉及 html 和 js 文件，因此，升级时只要 git pull 即可，不需要重新编译，也不需要重启程序。
- 因为本站大体上是前后端分离的，当只有前端改动时，在浏览器刷新页面即可，完全不用动后端。

```
$ cd uglynotes
$ git pull
```

## 2021-01-20 (新增命令行参数 -dir)

- 原本只能在用户目录 ($HOME) 下创建数据库文件夹。
- 现在新增 -dir 参数，可指定任意目录作为数据库文件夹。

### 指定相对路径

例如，以下命令可指定 `./ugly-db` 作为数据库的文件夹

```sh
$ ./uglynotes -dir "ugly-db"
```

### 指定绝对路径

例如，以下命令可指定 `D:\ugly-db` 作为数据库的文件夹

```sh
$ .\uglynotes.exe -dir "D:\ugly-db" 
```


## 2021-01-20 (历史版本系统升级)

### 旧系统

- 每个历史版本都保存全文
- 为了节约空间，历史版本数量有上限，滚动覆盖，并可选择性删除
- 为了避免重要的历史版本被覆盖，又提供了 “保护” 功能
- 在数据库中，`历史版本表` 与 `笔记表` 分开，使用 `导出json` 功能时只导出笔记表，不包含历史版本。
- 默认每 1 分钟产生一个历史版本

### 新系统

- 每个历史版本只保存差异
- 由于只保存差异，非常节省空间，因此历史版本不设上限，永不删除
- 在数据库中，废除了 `历史版本表`, 使用 `导出json` 功能时包含全部数据（包括全部历史版本）
- 默认每 5 分钟产生一个历史版本，可自由设置，但**建议不要改动**，如果太频繁保存，反而会让历史版本变得更零碎（空间不会增加太多，但翻看历史时体验不好，5 分钟或 10 分钟是最好的）
- 查看历史版本的页面也升级了，更直观，更高效。

### 升级方法

一般来说，应该可以顺利升级，不会丢失数据，但当然最好还是先备份，备份方法是把在本地的整个 uglynotes 打包或复制到另一个地方，并且将 uglynotes.db 也复制到另一个地方（注意是复制不是移动）。

#### 后端升级

（后端升级后，会自动把数据库中已有的历史版本内容转换成新格式。）

```sh
$ cd uglynotes
$ git pull
$ go build
$ killall uglynotes
$ ./uglynotes -config /path/to/settings.json &
```

#### 前端升级

由于前端页面有缓存，有些页面可能需要按一下 Ctrl-Shift-R 强制刷新 (多数情况下不需要)。
