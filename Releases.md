# Releases 新版说明


## 2021-01-25 (fix: 关于 patch 的一个 bug)

**推荐程度**：本次更新修复了一个 bug, 建议尽快更新。

- 修复前：对 patch 进行了 TrimSpace 操作，导致在某些情况下 patchApply 失败 (受影响的笔记无法打开)。
- 修复后：正确处理 pathc, 但之前受影响的笔记需要手动恢复。

### 修复方法：

更新代码及重新编译、重启程序；

```sh
$ cd uglynotes
$ git pull
$ go build
$ killall uglynotes
$ ./uglynotes -config /path/to/settings.json &
```

## 2021-01-23 (增加备份/导出功能)

**推荐程度**：本次更新主要新增一个功能，建议需要该功能的用户更新。

- add: 增加了 Backup 页面，可方便地下载 unglynotes.db 或将整个数据库导出为 json 格式。
- change: 清除了所有链接的下划线，看起来舒服多了。


## 2021-01-22 (fix: 标签页面排序问题)

**推荐程度**：本次更新修复了一个很小的 bug, 增加了几个小功能，建议等有空才更新。

- fix: 标签页面的笔记列表应按更新日期排序，已修复。
- add: 在笔记列表，每一项增加了一个 edit 按钮（原本需要先查看笔记才有 edit 按钮）。
- add: 新增 home 页面（原本用 login 页面来展示站点地图，现在移到 home 页面了）。
- add: 在 edit 页面增加 history 链接，方便查看历史版本。
- add: history 网址增加了参数 version, 可通过网址指定展示哪个历史版本。
- change: Tag Groups 页面的 input 改成 textarea (原本的输入框太小了)。

## 2021-01-21 (fix: 标签的问题)

**推荐程度**：本次更新修复了一个 bug, 建议尽快更新。

- 修复前：在编辑笔记页面修改标签时，"标签表" 不更新。
- 修复后：在编辑笔记页面修改标签时，"标签表" 可正确更新。

### 修复方法：

1. 更新代码及重新编译、重启程序；
2. 登入网站后，在 home 页面按 F12 打开控制台，在控制台输入 `restoretags()` 按回车执行，即可修复 "标签表"。


## 2021-01-21 (增加回收站)

**推荐程度**：本次更新主要新增一个功能，建议需要该功能的用户更新。

- 升级前：删除笔记只是做了一个”删除“标志，没有彻底删除。但没有做”回收站“页面。
- 升级后：增加了回收站, 可以进行复原或彻底删除。
- 升级方法：

```sh
$ cd uglynotes
$ git pull
$ go build
$ killall uglynotes
$ ./uglynotes -config /path/to/settings.json &
```


## 2021-01-20 (在 note.html 显示笔记创建日期)

**推荐程度**：本次更新主要新增一个功能，建议需要该功能的用户更新。

- 该更新不涉及 go 文件，只涉及 html 和 js 文件，因此，升级时只要 git pull 即可，不需要重新编译，也不需要重启程序。
- 因为本站大体上是前后端分离的，当只有前端改动时，在浏览器刷新页面即可，完全不用动后端。

```
$ cd uglynotes
$ git pull
```

## 2021-01-20 (新增命令行参数 -dir)

**推荐程度**：本次更新主要新增一个功能，建议需要该功能的用户更新。

- 原本只能在用户目录 ($HOME) 下创建数据库文件夹。
- 现在新增 -dir 参数，可指定任意目录作为数据库文件夹。

### 指定相对路径

例如，以下命令可指定 `./ugly-db` 作为数据库的文件夹

```sh
$ ./uglynotes -dir "ugly-db"
```

### 指定绝对路径

例如，以下命令可指定 `D:\ugly-db` 作为数据库的文件夹

```sh
$ .\uglynotes.exe -dir "D:\ugly-db" 
```


## 2021-01-20 (历史版本系统升级)

### 推荐程度

本次更新对系统性能提升很大，建议尽快升级。

### 旧系统

- 每个历史版本都保存全文
- 为了节约空间，历史版本数量有上限，滚动覆盖，并可选择性删除
- 为了避免重要的历史版本被覆盖，又提供了 “保护” 功能
- 在数据库中，`历史版本表` 与 `笔记表` 分开，使用 `导出json` 功能时只导出笔记表，不包含历史版本。
- 默认每 1 分钟产生一个历史版本

### 新系统

- 每个历史版本只保存差异
- 由于只保存差异，非常节省空间，因此历史版本不设上限，永不删除
- 在数据库中，废除了 `历史版本表`, 使用 `导出json` 功能时包含全部数据（包括全部历史版本）
- 默认每 5 分钟产生一个历史版本，可自由设置，但**建议不要改动**，如果太频繁保存，反而会让历史版本变得更零碎（空间不会增加太多，但翻看历史时体验不好，5 分钟或 10 分钟是最好的）
- 查看历史版本的页面也升级了，更直观，更高效。

### 升级方法

一般来说，应该可以顺利升级，不会丢失数据，但当然最好还是先备份，备份方法是把在本地的整个 uglynotes 打包或复制到另一个地方，并且将 uglynotes.db 也复制到另一个地方（注意是复制不是移动）。

#### 后端升级

（后端升级后，会自动把数据库中已有的历史版本内容转换成新格式。）

```sh
$ cd uglynotes
$ git pull
$ go build
$ killall uglynotes
$ ./uglynotes -config /path/to/settings.json &
```

#### 前端升级

由于前端页面有缓存，有些页面可能需要按一下 Ctrl-Shift-R 强制刷新 (多数情况下不需要)。
