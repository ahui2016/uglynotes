# Releases 新版说明


## 2021-06-01 (add: 在 Home 页面添加日程提醒)

如果当天有提醒，在 Home 页面的 "提醒事项" 旁会显示金色的 "today" 标志。

## 2021-05-06 (change: 标签页面列出相关标签组) 

- 旧版标签页面：列出与该标签相关的全部笔记。
- 新版标签页面：列出与该标签相关的全部标签组。
- 在 `/note` 和 `/tags` 页面里点击标签，也从原本的搜索笔记改成打开新版标签页面。
- 但在 `/tag/groups` 页面里点击标签还是保持原状（搜索与该标签有关的笔记），应该改成打开新版标签页面是最好的，但这里改起来很麻烦，就偷懒不改了。


## 2021-03-08 (add: 提醒事项 reminder 功能)

- 在编辑笔记页面新增 Reminder 按钮，可设置提醒日期。
- 设置了提醒日期的笔记会显示在 Reminder 列表中。
- 在 home 页面和 index 页面增加了提醒事项的入口。
- 如果在 settings.json 中设置 `"FirstPage": "/light/reminder"` 可把提醒事项页面设为首页。


## 2021-03-01 (change: 前端采用 mj.js 和 water.css 重写) 

**推荐程度**: 前端变好看了一点点，建议抽空升级。

- 旧版暂时还可以访问 http://note.ai42.xyz/home , 但今后有可能完全删除旧版页面。
- 新版 http://note.ai42.xyz/light/home
- 关于 mj.js 请看这里 https://github.com/ahui2016/mj.js

### 高级功能

新版前端页面还增加了两个隐藏功能，在编辑笔记的页面，按 F12 打开控制台，执行命令 `stopAutoSubmit()` 可停止自动提交，而执行命令 `restartAutoSubmit(delay)` 可重新启动自动提交（并可同时设置间隔时间，单位是秒），比如 `restartAutoSubmit(60 * 30)` 可设置为每隔 30 分钟自动提交一次笔记更新。


## 2021-02-03 (change: 数据库改用 sqlite)

**推荐程度**: 原来用的数据库有些小问题，建议将旧数据库导出为 json 后升级。

- 升级前：用 Storm 数据库(底层是 Bolt), 但它的索引经常出错。
- 升级后：改用 go-sqlite3, 优点是稳定，缺点是依赖 cgo (原本就是因为不想依赖 cgo 才用 Storm 的，无奈 Storm 不争气)。

### 升级方法：（注意备份）

1. 如果你正在使用 2021-01-23 之前的版本，请先升级至 2021-01-23 的版本（因为 2021-01-23 新增了备份导出功能）：
    ```sh
    $ cd uglynotes
    $ git pull
    $ git checkout 3726d88
    $ go build
    $ ./uglynotes -config /path/to/settings.json &
    ```
2. 如果你正在使用 2021-01-23 之后的版本，或者经过上面第 1 步的升级后，就有了备份导出功能。请正常登入，在 /home 页面可以看到 `Backup` 链接，点击进入后，下载备份，并导出 json, 下载 json 文件。
3. 然后再升级到使用了 sqlite 数据库的版本（**注意：在进行以下操作前，一定要先下载 json 文件，用文本编辑器打开 json 文件确认里面有内容。**）:
    ```sh
    $ cd uglynotes
    $ git checkout main
    $ git pull
    $ go build
    $ killall uglynotes
    $ mv uglynotes_data_folder/uglynotes.db uglynotes_data_folder/uglynotes.db.old
    $ ./uglynotes -config /path/to/settings.json &
    ```
4. 正常登入网站后，在 /home 页面按 F12 进入控制台，输入命令 `importnotes()` 回车，即可导入旧笔记。

至此，升级完成。升级后标签和标签组会被重建（与笔记没有关联的标签和标签组会丢失），笔记内容不会丢失。如有任何问题可与我联系，只要在上面第 2 步导出了 json 文件（并确认文件里有内容），就必然有办法恢复笔记内容。


## 2021-01-25 (fix: 关于 patch 的一个 bug)

**推荐程度**：本次更新修复了一个 bug, 建议尽快更新。

- 修复前：对 patch 进行了 TrimSpace 操作，导致在某些情况下 patchApply 失败 (受影响的笔记无法打开)。
- 修复后：正确处理 patch, 但之前受影响的笔记需要手动恢复。

### 修复方法：

更新代码及重新编译、重启程序；

```sh
$ cd uglynotes
$ git pull
$ go build
$ killall uglynotes
$ ./uglynotes -config /path/to/settings.json &
```

## 2021-01-25 (add: 快捷键)

在笔记编辑页面添加了一些快捷键：

- **Alt-Shift-P**: 预览(preview)
- **Alt-Shift-E**: 编辑(edit)
- **Alt-Shift-C**: 笔记编辑框(contents)
- **Alt-Shift-T**: 标签编辑框(tags)

在 Chrome 里可以使用 **Alt-C** 和 **Alt-T** 分别跳到笔记编辑框和标签编辑框。 Mac 用户请用 option 键代替 alt 键。

另外，当光标在笔记编辑框时，按 Tab 键可跳到标签编辑框，再按 Shift + Tab 可跳回到笔记编辑框。


## 2021-01-23 (add: 备份/导出功能)

**推荐程度**：本次更新主要新增一个功能，建议需要该功能的用户更新。

- add: 增加了 Backup 页面，可方便地下载 unglynotes.db 或将整个数据库导出为 json 格式。
- change: 清除了所有链接的下划线，看起来舒服多了。


## 2021-01-22 (fix: 标签页面排序问题)

**推荐程度**：本次更新修复了一个很小的 bug, 增加了几个小功能，建议等有空才更新。

- fix: 标签页面的笔记列表应按更新日期排序，已修复。
- add: 在笔记列表，每一项增加了一个 edit 按钮（原本需要先查看笔记才有 edit 按钮）。
- add: 新增 home 页面（原本用 login 页面来展示站点地图，现在移到 home 页面了）。
- add: 在 edit 页面增加 history 链接，方便查看历史版本。
- add: history 网址增加了参数 version, 可通过网址指定展示哪个历史版本。
- change: Tag Groups 页面的 input 改成 textarea (原本的输入框太小了)。

## 2021-01-21 (fix: 标签的问题)

**推荐程度**：本次更新修复了一个 bug, 建议尽快更新。

- 修复前：在编辑笔记页面修改标签时，"标签表" 不更新。
- 修复后：在编辑笔记页面修改标签时，"标签表" 可正确更新。

### 修复方法：

1. 更新代码及重新编译、重启程序；
2. 登入网站后，在 home 页面按 F12 打开控制台，在控制台输入 `restoretags()` 按回车执行，即可修复 "标签表"。


## 2021-01-21 (增加回收站)

**推荐程度**：本次更新主要新增一个功能，建议需要该功能的用户更新。

- 升级前：删除笔记只是做了一个”删除“标志，没有彻底删除。但没有做”回收站“页面。
- 升级后：增加了回收站, 可以进行复原或彻底删除。
- 升级方法：

```sh
$ cd uglynotes
$ git pull
$ go build
$ killall uglynotes
$ ./uglynotes -config /path/to/settings.json &
```


## 2021-01-20 (在 note.html 显示笔记创建日期)

**推荐程度**：本次更新主要新增一个功能，建议需要该功能的用户更新。

- 该更新不涉及 go 文件，只涉及 html 和 js 文件，因此，升级时只要 git pull 即可，不需要重新编译，也不需要重启程序。
- 因为本站大体上是前后端分离的，当只有前端改动时，在浏览器刷新页面即可，完全不用动后端。

```
$ cd uglynotes
$ git pull
```

## 2021-01-20 (新增命令行参数 -dir)

**推荐程度**：本次更新主要新增一个功能，建议需要该功能的用户更新。

- 原本只能在用户目录 ($HOME) 下创建数据库文件夹。
- 现在新增 -dir 参数，可指定任意目录作为数据库文件夹。

### 指定相对路径

例如，以下命令可指定 `./ugly-db` 作为数据库的文件夹

```sh
$ ./uglynotes -dir "ugly-db"
```

### 指定绝对路径

例如，以下命令可指定 `D:\ugly-db` 作为数据库的文件夹

```sh
$ .\uglynotes.exe -dir "D:\ugly-db" 
```


## 2021-01-20 (历史版本系统升级)

### 推荐程度

本次更新对系统性能提升很大，建议尽快升级。

### 旧系统

- 每个历史版本都保存全文
- 为了节约空间，历史版本数量有上限，滚动覆盖，并可选择性删除
- 为了避免重要的历史版本被覆盖，又提供了 “保护” 功能
- 在数据库中，`历史版本表` 与 `笔记表` 分开，使用 `导出json` 功能时只导出笔记表，不包含历史版本。
- 默认每 1 分钟产生一个历史版本

### 新系统

- 每个历史版本只保存差异
- 由于只保存差异，非常节省空间，因此历史版本不设上限，永不删除
- 在数据库中，废除了 `历史版本表`, 使用 `导出json` 功能时包含全部数据（包括全部历史版本）
- 默认每 5 分钟产生一个历史版本，可自由设置，但**建议不要改动**，如果太频繁保存，反而会让历史版本变得更零碎（空间不会增加太多，但翻看历史时体验不好，5 分钟或 10 分钟是最好的）
- 查看历史版本的页面也升级了，更直观，更高效。

### 升级方法

一般来说，应该可以顺利升级，不会丢失数据，但当然最好还是先备份，备份方法是把在本地的整个 uglynotes 打包或复制到另一个地方，并且将 uglynotes.db 也复制到另一个地方（注意是复制不是移动）。

#### 后端升级

（后端升级后，会自动把数据库中已有的历史版本内容转换成新格式。）

```sh
$ cd uglynotes
$ git pull
$ go build
$ killall uglynotes
$ ./uglynotes -config /path/to/settings.json &
```

#### 前端升级

由于前端页面有缓存，有些页面可能需要按一下 Ctrl-Shift-R 强制刷新 (多数情况下不需要)。